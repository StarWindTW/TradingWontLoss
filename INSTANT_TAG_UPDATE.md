# 🏷️ 即時標籤更新功能

## ✨ 新功能

點擊標籤即可立即更新 Discord 論壇帖子的標籤，無需額外點擊保存按鈕！

## 🎯 使用方式

### 1. 打開信號詳情頁面

進入任意歷史信號的詳情頁面：
- 從歷史列表點擊 "查看詳情"
- 或直接訪問 `/history/[id]`

### 2. 查看論壇標籤區域

在詳情頁面的底部，您會看到：

```
論壇標籤 (點擊即時更新，最多5個)
```

下方顯示所有可用的論壇標籤。

### 3. 點擊標籤

**選擇標籤：**
- 點擊灰色標籤 → 立即變成藍色並同步到 Discord ✅

**取消標籤：**
- 點擊藍色標籤 → 立即變成灰色並從 Discord 移除 ❌

### 4. 自動更新

點擊後：
1. **標籤立即變色**（提供即時視覺反饋）
2. **顯示 "更新中..."**（在標籤下方）
3. **自動同步到 Discord**（後台進行）
4. **顯示成功提示**（右上角）

## 🔄 工作流程

### 成功流程

```
用戶點擊標籤
    ↓
UI 立即更新（視覺反饋）
    ↓
發送請求到 Discord API
    ↓
Discord 標籤更新
    ↓
顯示成功提示 ✅
```

### 失敗流程

```
用戶點擊標籤
    ↓
UI 立即更新（視覺反饋）
    ↓
發送請求到 Discord API
    ↓
❌ 更新失敗
    ↓
UI 自動恢復到原來的狀態
    ↓
顯示錯誤提示
```

## 💡 功能特性

### ✅ 即時更新
- 點擊即更新，無需保存
- 立即的視覺反饋
- 後台自動同步

### 🔒 防止重複點擊
- 更新時自動禁用點擊
- 鼠標變成 "等待" 圖標
- 標籤變暗（透明度 60%）

### 📊 視覺狀態

**未選中標籤：**
- 灰色背景
- 1px 邊框
- 可點擊（手形游標）

**已選中標籤：**
- 藍色背景
- 2px 藍色邊框
- 可點擊（手形游標）

**更新中：**
- 所有標籤變暗
- 游標變成等待圖標
- 顯示 "更新中..." 提示

### ⚡ 懸停效果

**鼠標懸停時：**
- 背景變深
- 標籤微微放大（scale 1.05）
- 平滑的過渡動畫

**更新時懸停：**
- 不縮放（防止誤導）
- 保持等待狀態

### 🛡️ 錯誤處理

**自動回滾：**
- 如果更新失敗
- UI 自動恢復到更新前的狀態
- 保持數據一致性

**錯誤提示：**
- 顯示具體錯誤原因
- 紅色 Toast 通知
- 包含失敗詳情

## 🎨 UI 變化

### 之前（舊版）

```
[標籤1] [標籤2] [標籤3] [標籤4]

[更新標籤] 按鈕
```

操作步驟：
1. 點擊標籤選擇
2. 點擊 "更新標籤" 按鈕
3. 等待更新

### 之後（新版）

```
論壇標籤 (點擊即時更新，最多5個)

[標籤1] [標籤2] [標籤3] [標籤4]

（更新時顯示：⏳ 更新中...）
```

操作步驟：
1. 點擊標籤 → 完成！✅

## 📝 使用示例

### 示例 1：添加標籤

1. 看到灰色標籤 "✅ 已平倉"
2. 點擊該標籤
3. 標籤立即變成藍色
4. 看到 "更新中..." 提示
5. 1秒後看到 "標籤已更新" 成功提示
6. Discord 上的帖子標籤同步更新

### 示例 2：移除標籤

1. 看到藍色標籤 "🔥 熱門"
2. 點擊該標籤
3. 標籤立即變成灰色
4. 看到 "更新中..." 提示
5. 1秒後看到 "標籤已更新" 成功提示
6. Discord 上的帖子移除該標籤

### 示例 3：超過限制

1. 已經選擇了 5 個標籤
2. 嘗試點擊第 6 個標籤
3. 看到警告："最多只能選擇 5 個標籤"
4. 標籤不會被選中

### 示例 4：更新失敗（自動恢復）

1. 點擊標籤（假設網絡斷開）
2. 標籤立即變藍（樂觀更新）
3. 後台請求失敗
4. 標籤自動恢復成灰色
5. 顯示錯誤提示："更新標籤失敗"

## 🔧 技術實現

### 關鍵特性

**樂觀更新 (Optimistic Update):**
```typescript
// 1. 立即更新 UI
setSelectedForumTags(newSelectedTags);

// 2. 發送 API 請求
await axios.patch(...)

// 3. 如果失敗，回滾 UI
catch (error) {
  setSelectedForumTags(selectedForumTags); // 恢復
}
```

**防抖處理:**
```typescript
if (isUpdatingTags) return; // 防止重複點擊
setIsUpdatingTags(true);
// ... 更新邏輯
setIsUpdatingTags(false);
```

**視覺反饋:**
```typescript
cursor={isUpdatingTags ? 'wait' : 'pointer'}
opacity={isUpdatingTags ? 0.6 : 1}
```

## 🎯 用戶體驗改進

### 速度提升

**之前：**
- 選擇標籤
- 點擊按鈕
- 等待更新
- 看到結果

總共：**3-4 步操作**

**之後：**
- 點擊標籤
- 看到結果

總共：**1 步操作** ⚡

### 反饋更快

**之前：**
- 點擊按鈕後等待
- 不知道是否在處理
- 2-3 秒後看到結果

**之後：**
- 點擊後立即看到變化
- 知道正在更新
- 感覺更快更流暢

### 更直觀

**之前：**
- 需要記住要點擊按鈕
- 兩步操作

**之後：**
- 點擊即更新
- 符合現代 UI 習慣（如 iOS 開關）

## 🚀 最佳實踐

### ✅ 推薦做法

1. **快速選擇**：可以連續點擊多個標籤
2. **等待完成**：每次點擊等待 1-2 秒確保更新完成
3. **檢查 Discord**：重要更新後可以去 Discord 確認

### ⚠️ 注意事項

1. **不要快速連點**：等待 "更新中..." 消失後再點擊下一個
2. **檢查網絡**：如果頻繁失敗，檢查網絡連接
3. **最多 5 個**：Discord 論壇標籤限制為最多 5 個

## 🐛 故障排除

### 問題 1：點擊無反應

**可能原因：**
- 正在更新中（標籤變暗）
- 沒有關聯的 Discord 帖子

**解決方法：**
- 等待當前更新完成
- 檢查是否有 threadId

### 問題 2：更新失敗

**可能原因：**
- 網絡連接問題
- Discord API 限流
- 權限不足

**解決方法：**
- 檢查網絡
- 等待幾分鐘後重試
- 重新登錄

### 問題 3：標籤閃爍

**可能原因：**
- 更新失敗後自動回滾

**解決方法：**
- 查看錯誤提示
- 根據錯誤信息解決問題

## 📱 響應式設計

- ✅ 桌面端：完美支持
- ✅ 平板：標籤自動換行
- ✅ 手機：觸控友好

## 🎉 總結

### 主要優勢

1. ⚡ **速度快**：一鍵操作，即時更新
2. 👍 **體驗好**：樂觀更新，視覺反饋
3. 🛡️ **更安全**：自動回滾，錯誤處理
4. 🎨 **更美觀**：動畫流暢，狀態清晰

### 技術亮點

1. ✅ 樂觀更新（Optimistic UI）
2. ✅ 自動回滾（Error Recovery）
3. ✅ 防抖處理（Debouncing）
4. ✅ 視覺反饋（Loading States）

---

**享受更快更流暢的標籤管理體驗！** 🚀

